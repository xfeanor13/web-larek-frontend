# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/types - папка с файлами типизации компонентов

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```



## Архитектура приложения.
Приложение представляет собой интернет магазин в котором пользователю будут доступны следующие дейстивия.
- Просмотр списка товаров, полученного от сервера.
- Выбор товара для более подробного изучения. Откроется модальное окно карточки товара.
- Пользователь может положить товар в корзину.
- Открытие корзины и просмотр списка выбранных товаров.
- Возможность удалить товар из корзины как из модального окна карточки товара, так и из корзины.
- Оформление заказа, ввод контатных данных и выбор способа оплаты. 
- Совершение покупки, путем нажатия соответствующей кнопки. 

В реализации я буду использовать паттерн MVP.
Модель будет работать с данными, совершать запросы на сервер.
Отображение отвечает за перенос данных в верстку, слежение за действиями пользователя.
Презентер связывает между собой модели данных и отображение. Презентер имеет преимущество, заключающееся в том, что появляется возможность отдельной отладки, как Модели так и Вью, хотя я откровенно говоря, отдельно ничего не отлаживал.

Проанализирую данные, с которыми мне придется работать.

1. Объект товар. Его компонент - это карточка товара. Коллекция этих карточек будет отображена на главной странице, при клике на товар будет отображаться более подробная информация. Она же в скоращенном виде отображается в списке в корзине.
interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null; // есть товар, у которого нет цены
  }

- id - индивидуальный идентификационный номера товара.
- title - название товара
- category - категория товара
- description - подробное описание товара
- price - цена товара. Она может быть или числового типа, либо null, если товар бесценный.
- image - адрес ссылки на изображение товара

Когда я делаю запрос серверу для получения карточек товара я получаю ответ такого формата:
 {
    total: number;
    items: IProduct[];
}  где

- total - количество товаров (10шт.),
- items - массив объектов, тип которых приведен выше.

Сам запрос на сервер с заказом состоит из следующих данных:
- payment: PaymentType;
- address: string;
- email: string;
- phone: string;
- items: string[];
- total: number; 

где

- payment - выбор типа оплаты. Я его типизирую следующим образом  
  PaymentType = 
    'online' |  
    'personally' |  
    null;  

Пользователь может выбрать оплату онлайн, оплату лично при полученении заказа, изначально оплата не выбрана, то есть ее значение нулевое.
- address - адрес пользователя, строчное значение.
- email - почта пользователя, строчное значение.
- phone - телефон пользователя, строчное значение.
- total - общая сумма заказа, числовое значение. 


Данные корзины:  
interface IBasket {  
    items: string[];  
    total: number;  
  } 

  где
 - items - список выбранных товыров.
 - total - общая сумма заказа, числовое значение.

___
### Рассмотрим подробнее базовые классы, которые будут использоватся мною в проекте.  

#### Базовый класс Api.
Он предназначен для отправки запросов на сервер. На его базе я буду создавать свой класс DataApi.
В классе есть следующие поля:
- baseUrl - базовый URL, который будет подставляться в fetch.
- options - поле опции, в него прописываются настройки, которые добывляюся в headers, в fetch.  

Конструктор класса принимает на вход базовый URL и настройки в формате объекта.
URL прописывыется в поле, настройки добавляются в поле, по умолчанию там уже прописывается объект такого типа  
 headers:  
  {  
    'Content-Type': 'application/json',  
    ...(options.headers as object ?? {})  
}

Методы класса:
- Метод get принимает на вход строковое добавление, которое присовокупляется к базовому URL. Метод возвращается запрос fetch.
- метод post, делает тоже самое, но в нем принудительно прописывается метод POST. Дополнительным аргументом является объект данных, которые требуется отправить на сервер.  


#### Следующий базовый класс Component.
На его основе я буду создавать класса отображения тех или иных компонентов. 
В конструкторе класса я принимаю на вход HTMLElement, который будет являться объектом для рендеринга. 

Методы класса:  
- setText - метод принимает на вход Домэлемент и значение, внутри метода Дом элемент наполняется текстом из второго аргумента. Одним словом, убирает дублирование метода textContent.
- setDisabled - метод, принимает на вход Дом элемент и булево значение, в зависимости от него, делаел элемент неактивным.
- setHidden - принимает аргументом ДОМэлемент, делает его невидимым.
- setVisible - делает элемент видимым.
- setImage - принимает на вход ДОМЭлемент(HTMLImageElement), ссылку для src и подпись для альта. В методе все это устанавливается для изображения.
- render - метод рендеринга. В дочерних классах использхуется чаще всего. Принимает на вход данные типа из дженерика. И раскладывает их по полям перебирая все, поля которые есть в объекте, если таковыъ нет, он создает новые. Возвращает объект для рендеринга, который задавался в конструкторе с помощью аргумента.

#### Объект EventEmitter. ПРедназначен для работы брокера событий.  
Поля класса:  
- _events - поле, хранящее объект, в котором ключ типа EventName = string | RegExp, а значение массив уникальных функций.  

Конструктор класса. создает пустой объект в поле _events.  

Методы:  
- on метод принимает на вход название ключа(события) и функцию-коллбэк, которая должна на событие подписаться. Добавляет коллбэк по назаванию события в поле _events.
- off - метод позволяет удалить функций из списка подписчиков по названию события. Обратное действие.
- emit - метод инициирует событие, передавая подписчиком данные, необходимые для их работы. Данные типа объект. 

_______

### Класс DataApi.
ВЫполняет задачу работы с сервером, является дочерним классом Api.

Поля класса:  
- cdn - в поле хранится строковая добавка к адресу для запроса.

Конструктор принимает аргументом базовый URL и CDN, внутри происходит вызов родительского конструктора и запись единственного поля.

Методы класса:
- getProducts - метод отправляет запрос и получает от сервера массив карточек IProduct[]. НЕмного изменяет поле картинки, чтобы получилась готовая ссылка.
- getProduct - запрос и получение однйо карточки.
- sendOrder - метод отправки заказа на сервер.



### Далее рассмотрим классы модели данных.

#### Класс AppData.

В классе есть следующие поля:

- items: IProduct[] - список товаров. В это поле запмсывается массив карточек, полученных от сервера. 
- events: IEvents - объект брокера событий, с помощью которого презентер узнает об изменении данных в модели.
- basket: IBasket - объект "Корзина". В этом объекте я буду хранить список выбранных товаров, их номера, а также общую сумму заказа.
- order: IOrder - объект данных, собираемых для отправки заказа на сервер. Его типизацию я уже рассмотреол ранее.
- errorsOfForms - массив объектов, хранящий в себе ошибки валидации. Если какое-то поле внутри форм будет не заполнено, в этот массив поступит объект. Имя - названия пустого инпута, значение - текст ошибки, который нужно вывести в поле вывода ошибок валидации.
- preview: IProduct - поле, хранящее выбранную карточку товара. Когда пользователь кликнет на карточку товара для более подробного изучения, в это поле попадет объект конкретной карточки товара, который отправится аргументом для рендеринга карточки в модальном окне.  

Конструктор класса:  

Конструктор класса содержит внутри себя только лишь процедуру создания поля, которое будет хранить объект типа IEvents, объект брокера событий.  

Методы класса:  
- метод setItems - сеттер поля Items, принимает аргументом массив объектов, сохраняет их в поле, генерирует событие изменения поля передавая в презентер массив для дальнейшнего рендеринга на странице.
- setPreview - сеттер поля Preview,  принимает аргументом объект карточки товара, сохраняет ее в поле, генерирует событие изменения поля передавая в презентер массив для дальнейшнего рендеринга карточки в модальном окне.
- inBasket - метод проверяет, находится ли товар с идентифиатором из аргумента в корзине, возвращает булево значение.
- addToBasket - метод добавления товара в корзину. Принимает на вход обхект типа IProduct, добавляет его в массив товаров в корзине, вычисляет итогувою сумму заказа. Генерирует событие "Корзина изменилась", передавая аргументом объект корзина.
- removeFromBasket - метод удаления товара из корзины, делает все тоже самое, что и метод добавления, только товар удаляется из корзины.
- emptyBasket - метод полной очитски корзины. Список выбранных товаров обнуляется, как и итоговая сумма заказа. Метод генерирует событие "Корзина изменилась", передавая аргументом объект корзина.
- selectPayment - метод выбора типа оплаты. Принимает на вход тип оплаты(онлайн/персонально), и прописывает его в поле payment, объекта order.
- setOrderField - метод заполнения полей объекта order(заказ). Метод на вход два аргумента, название поля, которое нужно заполнить, а также значение, которое нужно прописать. Привыборе типа оплаты вызывается selectPayment, в ином случае просто прописывается поле. Названия полей допускаются типа IOrderForm, адрес, тип оплаты, почта и телефон. Метод запускает валидацию объекта Order, если все поля заполнены, значит генерируется событие 'order:ok', что означает заказ готов к отправке.
- validateOrder - метод валидирует поля объекта Order. При каждом его вызове генерируется событие изменения ошибок, которые требуется выводить в форму для отображения. Аргументом для вызова брокера событий является поле errorsOfForms типа Partial<Record<keyof IOrderForm, string>>. Его я описывал при описании соответствующего поля.
___

### Рассмотрим классы представления.  

#### Класс Basket
Класс предназначен для отображения корзины в модальном окне.  
Поля класса:  
- items - массив HTMLElementов, которые с помощью соотв. метода должны разместиться в вертске объекта рендеринга.
- _list - элемент, куда будет помещаться массив карточек из поля items. Сюда прописывается место контейнер, внутри объекта рендеринга, которое задается в конструкторе.
- _total - ДОмэлемент для отображения суммы заказа.
- _button - HTMLButtonElement, в этом поле будет храниться кнопка, отвечающая за сабмит формы.
_events - поле, где хранится объект "Брокер события", который используется один во всем проекте.  

Конструктор класса принимает на вход брокер событий, а также элемент контейнер. Часть верстки, представляющей из себя корзину. Внутри него задаются поля, с помощью аргументов, происходит поиск ДОМэлементов и заполнение полей _list, _total, _button. ТАкже на кнопку устанавливается слушатель, при нажатии на который генерируется событие 'order:open', открытие модального окна заказа.  

Методы класса:
- set total - метод заполняет значением из аргумента ДОМэлемент из поля _total.
- set items - метод заполняет массивом из ДОМэлементов поле _lis (карточки попадают в верстку), если в корзине есть хоть одни товар, кнопка оформления заказа становится доступной для нажатия. Если корзина пуста, кнопку нажать не получится.

#### Класс Form.  
Этот класс предназначен для работы с формами, это класс родительский, для своего проекта я буду делать дочерние класс заказа и контактов. Сам по себе класс является дочерним классом класса Component.  
Поля класса:  
- _submit - у любой формы должна быть кнопка сабмит, ее ДОМЭлемент будет храниться в этом поле.  
- _errors - в этом поле будет храниться ДОМЭлемент места, куда будут выводиться ошибки валидации.
- events - поле, в котором будет храниться объект брокера событий.  
- errors - поле хранит, массив строковых значений, которые нужно вывести в _errors. Но я это поле не использую.
- valid, поле необходимо для работы логики сеттера, геттера оно не имеет.

Конструктор класса:  
Аргументами конструктора является брокер событий и ДОМЭлемент объекта для рендеринга(Кусок верстки, с которым нужно будет работать). Внутри конструктора я устанавливаю бркоер событий, нахожу и устанавливаю кнопку сабмит и поле вывода ошибок валидации. Также назначается слушатель на все инпуты внутри формы, при изменении какого-либо инпута вызывается метод, который генерирует событие и отправляет данные в презентер. Также устанавливается слушатель на кнопку, при нажатии генерируется событие "форма:сабмит", которое инициирует следующее действие.  

Методы класса:
- onInputChange - метод генерирует вызов событий из брокера события и формирует данные для отправки колл-бэку. Название событие содержит в себе название инпута, объект данных - хранит в себе ключ, что изменилось, значение, какое теперь значение. Например {адрес, "текст адреса"}.
- set valid - сеттер меняет доступность кнопки сабмит в зависимости от аргумента, если пришло ТРу, значит кнопку нужно сделать доступной и наоборот.
- set errors - метод наполянет текстом из аргумента ДОМЭлемент из поля _errors.
-  render - метод рендерит контейнер из конструктора, перебирая данные, которые метод получает из аргумента.

#### Класс Modal, отвечающий за работу модального окна.  
Поля класса:
- _closeButton- хранит ДОМЭлемент кнопки крестика, закрытия модального окна.
- _content - хранит ДОМЭлемент, куда потом помещается содержимое модально окна. Коризна, картчока, оформление заказа.
- events - объект брокера событий.

Конструктор класса принимает на вход брокер событий и ДОМэлемент вертки модального окна. В конструкторе устанавливаются поля _closeButton, _content, events, назначаются 3 слушателя. 
1. Кнопка закрытия модального окна, для закрытия модального окна 
2.  нажатие на модальное окно вне внутреннего контекста, для закрытия модального окна 
3. Нажатие на внутренний контекст модального окна. чтобы ничего не происходило. Остановка всплытия.  

Методы класса:  
- set content. Метод наполняет ДОМ эелемент из поля _content, версткой, которая хранится в ДОМэлементе из аргумента.
- open() - метод открытия модального окна. в this.container из конструктора хранится ДОМ этого окна. поэтому метод без аргументов. Инициируется событие 'modal:open' модальное окно открыто.
- close() - метод закрытия модального окна. Инициируется событие 'modal:close' модальное окно закрыто.
- handleEscKeyUp - метод коллбэк слушателя всего документа на предмет нажатия клавиши ESC, если клавиша нажимается. модальное окно закрывается.
- render - метод рендеринга модального окна. Идет наполнения контентом, данными из аргумента типа HTMLElement.

#### Класс Order.  
Отвечает за отображение начала оформления заказа. Является дочерним классом по отношению к классу Form.
 Поля класса:
 - _paymentOnline - ДОМЭлемент кнопки "оплата онлайн".
 - _paymentPersonally - ДОМЭлемент кнопки "оплата при получении".

 Конструктор класса принимает на вход контейнер для рендеринга а также объект брокера событий. Внутри него эти поля, естественно устанавливаются, как и две кнопки. далее устанавливаются слушатели на кнопки. Внутри слушателей вызывается метод onInputChange, вызывающий соотв. событие и его последующую обработку. 

Методы класса:
- set payment - устанавливает иной стиль кнопки при нажатии на нее.
- set address - метод устанавливает значение инпута значением из аргумента. 

#### Класс Contacts.
Класс отвечает за отображение окна заполнения контактов. Является дочерним классом по отношению к классу Form.
Конструктор устанавливает поле контейнера для верствки.   

Метода класса:  
- set email - устанавливает значение инпута почта строковым значением из аргумента.
- set phone- метод устанавливает значение инпута телефон строковым значением из аргумента.



#### Класс Success. 
Отвечает за контент для модального окна, когда покупка успешно совершена.

Поля класса:
- _total - хранит в себе ДОМэлемент места, где нужно прописать сумму покупки.
- _close - хранит в себе ДОМэлемент кнопки "К новым покупкам"

Конструктор класса принимает на вход ДОМэлемент верстки окна, а также коллбэк действия на кнопку. Внутри него идет поиск и установка полей, а также установка слушателя на кнопку с добавлением колл-бэка. В нашем случае, это закрытие модального окна.  

Методы класса:  
- set total - метод добавляет в верстку сумму заказа из аргумента метода.  

#### Класс Card отвечающий за рендеринг карточки.

Поля класса:
- _title- здесь хранится ДОМэлемент, в котором отображается название товара.
- _price - здесь хранится ДОМэлемент, в котором отображается цена товара.

Конструктор принимает на вход ДОМэлемент объекта верстки, а также функию колл-бэк.
Внутри него находятся и устанавливаются вышеописанные поля. А также устанавливаются слушатели, либо на саму карточку, либо на кнопку внутри карточки.

Методы класса: 
- toogle - метод установки класса(стилей карточки), в зависимости от ее типа. Подробная, короткая. 
- set id - метод прописывания атрибута id. Принимается ид аргументом.
- get id - метод считывания атрибута id, он возвращается в методе.
- далее идут сеттеры заполнения остальных полей. Каждый сеттер заполняет значением из аргумента свой ДОМЭлемент.

#### Класс CardInGallery
Расширяет класс Card, является родительским классом для карточки товара в модальном окне. Отображение карточки товара в галерее.
Поля класса:
- cardCategory: HTMLElement - отображение тэга товара.
- image: HTMLElement - отображение картинки товара.
- cardSelectButton: HTMLButtonElement - для выбора всего элемента карточки для открытия.

#### Класс CardInModal
Расширяет класс CardInGallery. отображение карточки товара в модальном окне.
Поля класса:
- cardDescription: HTMLElement - отображение описания товара.
- сardInModalButton: HTMLElement - кнопка "Добавить/убрать" товар.

#### Класс CardInBasket
Расширяет класс Card. отображение карточки товара в корзине товаров.
Поля класса:
- cardNum: HTMLElement - отображение порядкового номера товара в корзине.
- cardDeleteButton: HTMLButtonElement - отображение удаления товара из корзины.

#### Класс Page.
Класс отвечает за отображение главной страницы.

Поля класса:
- _wrapper - здесь хранится ДОМэлемент отвечающий за контент внутри боди.
- _catalog - здесь хранится ДОМэлемент, в который помещается список карточек.
- _basket - здесь хранится ДОМэлемент кнопки корзины.
- _counter - здесь хранится ДОМэлемент счетчика количестват оваров на кнопке корзины.

Конструктор класса:
Аргумент, конейнер для верстки и брокер событий. Внутри конструктора я нахожу и устанавливаю поля ДОМэлементов, а также вешаю слушатель на кноку корзины. При нажатии на которую, генерируется событие 'basket:open'.

Методы класса:
- set counter - установка значения счетчика количества товаров числовым значением из аргумента.
- set catalog - заполнение каталога карточек массивом карточек HTMLElement[].
- set locked - метод добавляет класс на фон, при открытии модального окна. Чтобы экран приезжал наверх.
